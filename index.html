
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>è‹±èªè¨ºæ–­ - GitHubå…¬é–‹ç‰ˆ</title>
  <style>
    body {
      font-family: 'Yu Gothic', 'Meiryo', sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #333;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    .option {
      background: #f0f0f0;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      cursor: pointer;
    }
    .option.selected {
      background: #667eea;
      color: white;
    }
    button {
      margin-top: 20px;
      padding: 10px 25px;
      border-radius: 10px;
      font-weight: bold;
      background: #667eea;
      color: white;
      border: none;
      cursor: pointer;
    }
    #result {
      display: none;
      margin-top: 30px;
    }
    audio {
      margin-top: 10px;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>ğŸ¯ ãƒˆãƒ“ãƒ¼ã‚ºè‹±èªå­¦ç¿’è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ30å•ï¼‰</h1>
  <div id="question-box"></div>
  <div id="result"></div>
</div>
<script>
const totalQuestions = 30;
const questions = Array.from({length: totalQuestions}, (_, i) => `è³ªå• ${i+1}ï¼šã“ã‚Œã¯ä»®ã®è³ªå•æ–‡ã§ã™ã€‚`);
const options = Array.from({length: totalQuestions}, () => ["é¸æŠè‚¢A", "é¸æŠè‚¢B", "é¸æŠè‚¢C", "é¸æŠè‚¢D"]);
const correctAnswers = Array.from({length: totalQuestions}, () => 0);

let current = 0;
let correct = 0;
const answers = {};

function renderQuestion() {
  const box = document.getElementById("question-box");
  const q = questions[current];
  const opts = options[current];
  box.innerHTML = `<h3>${q}</h3>`;
  opts.forEach((opt, i) => {
    const div = document.createElement("div");
    div.className = "option";
    div.textContent = opt;
    div.onclick = () => {
      document.querySelectorAll(".option").forEach(el => el.classList.remove("selected"));
      div.classList.add("selected");
      answers[current] = i;
      document.getElementById("next-btn").disabled = false;
    };
    box.appendChild(div);
  });
  const btn = document.createElement("button");
  btn.id = "next-btn";
  btn.textContent = current < totalQuestions - 1 ? "æ¬¡ã¸" : "è¨ºæ–­çµæœã¸";
  btn.disabled = true;
  btn.onclick = next;
  box.appendChild(btn);
}

function next() {
  if (answers[current] === correctAnswers[current]) correct++;
  current++;
  if (current < totalQuestions) {
    renderQuestion();
  } else {
    showResult();
  }
}

function showResult() {
  document.getElementById("question-box").style.display = "none";
  const result = document.getElementById("result");
  result.style.display = "block";
  const rate = correct / totalQuestions;
  let level = rate >= 0.9 ? "è‹±æ¤œæº–1ç´šã€œ1ç´š / TOEFL 90ã€œ100ç‚¹"
            : rate >= 0.75 ? "è‹±æ¤œ2ç´šã€œæº–1ç´š / TOEFL 75ã€œ89ç‚¹"
            : rate >= 0.6 ? "è‹±æ¤œæº–2ç´šã€œ2ç´š / TOEFL 60ã€œ74ç‚¹"
            : "è‹±æ¤œ3ç´šä»¥ä¸‹ / TOEFL ã€œ59ç‚¹";

  result.innerHTML = `
    <h2>è¨ºæ–­çµæœ</h2>
    <p>ã‚ãªãŸã®æ­£è§£æ•°ã¯ <strong>${correct}/${totalQuestions}</strong> ã§ã™ã€‚</p>
    <p>æ¨å®šãƒ¬ãƒ™ãƒ«ï¼š<strong>${level}</strong></p>
    <p id="balloon"></p>
    <img src="https://cdn-icons-png.flaticon.com/512/2729/2729021.png" style="max-width:150px; margin-top:20px;" />
    <p>ğŸ¤ ç™ºéŸ³ç·´ç¿’ï¼š"I would like to practice my English pronunciation."</p>
    <button id="record">ğŸ”´ éŒ²éŸ³</button>
    <button id="play" disabled>â–¶ï¸ å†ç”Ÿ</button>
    <audio id="audio" controls></audio>
  `;

  const msg = rate >= 0.75 ? "ã™ã°ã‚‰ã—ã„ï¼ã‚ãªãŸã¯è‹±èªãƒã‚¹ã‚¿ãƒ¼ç´šã§ã™ã€‚"
            : rate >= 0.6 ? "ã¨ã¦ã‚‚ã„ã„æ„Ÿã˜ï¼ä¸­ç´šã«è¿‘ã¥ã„ã¦ã„ã¾ã™ã€‚"
            : "ã‚†ã£ãã‚Šã§å¤§ä¸ˆå¤«ã€ã“ã‚Œã‹ã‚‰ä¸€ç·’ã«ãŒã‚“ã°ã‚Šã¾ã—ã‚‡ã†ï¼";

  document.getElementById("balloon").textContent = msg;
  const speech = new SpeechSynthesisUtterance(msg);
  speech.lang = 'ja-JP';
  speechSynthesis.speak(speech);

  // ç™ºéŸ³éŒ²éŸ³å†ç”Ÿ
  let recorder, chunks = [];
  const recordBtn = document.getElementById("record");
  const playBtn = document.getElementById("play");
  const audio = document.getElementById("audio");

  recordBtn.onclick = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    recorder = new MediaRecorder(stream);
    recorder.ondataavailable = e => chunks.push(e.data);
    recorder.onstop = () => {
      const blob = new Blob(chunks, { type: "audio/wav" });
      audio.src = URL.createObjectURL(blob);
      playBtn.disabled = false;
      chunks = [];
    };
    recorder.start();
    recordBtn.textContent = "â¹ï¸ åœæ­¢";
    recordBtn.onclick = () => {
      recorder.stop();
      recordBtn.textContent = "ğŸ”´ éŒ²éŸ³";
    };
  };
  playBtn.onclick = () => audio.play();
}

renderQuestion();
</script>
</body>
</html>
